---
sidebar: auto
title: lab3 (DynamoDB)
---

クラウドアーキテクト・ファーストステップ ラボ3
==
#### 〜 Amazon DynamoDB を使った NoSQL データベースの構築 〜
###### v23.08.22.01

# 概要
- このラボでは、Amazon DynamoDB に新しいテーブルを作成し、NoSQL データベースの操作を体験します。
- 所要時間は約25分です

---

# この演習で学べること
- マネジメントコンソールを利用した DynamoDB の構築とデータ操作の方法
- DynamoDB のデータ操作と検索方法

# 演習の前にお読みください
- マネジメントコンソールへのログインURL、ユーザー名、パスワードは受講当日に講師から伝えられます
- マネジメントコンソールへの文字入力は、必ず半角英数字でのみ行ってください
- 手順中に設定の指示がない場合は、画面上での値の入力や変更は不要です。次の手順に進んでください
- 設定値を入力する場合は、できるだけコピペしてください。手入力は記載ミスの恐れがあります
- 演習手順について講師に確認する場合は、項目の番号をお伝え下さい。例：2-3の手順5番
## 凡例
- 手順書内での凡例は以下の通りです。ご活用ください
    - 補足
    > 作業手順の補足事項を記載しています
    - 予備知識
    :::tip
    予備知識を記載しています
    :::
    - 注意 
    :::warning
    主に、作業ミスの起きやすいポイントや注意事項を記載しています
    :::
    - 動作不良等
    :::danger
    うまく動作しないときに確認するポイントを記載しています。講師に確認する際に、ご自分でもチェックしてみてください
    :::
# 演習環境の有効期限等について
- 演習環境の有効期限は、講義当日の23時までです。23時以降になると、パスワードが変更され利用できなくなります
- 演習で作成したリソースは、20時になると自動で削除されますのでご了承ください
- 講義終了後の演習環境でのログインは、上記時間までご自由に実施ください。演習を再度実行したい場合は、作成したリソースを削除してから実施してください

---

# 演習手順
## 1. AWSコンソールへのログイン
1. 講師から伝えられたログイン用のURLにWebブラウザでアクセスしてください。AWSのログイン画面が開きます
    > Zoomのチャットで配布された場合は、クリックするだけで画面が開きます
1. 講師から伝えられたユーザー名及びパスワードを入力して [サインイン] ボタンをクリックしてください

    ::: tip 
    ログイン直後の画面に**新しいAWSコンソールのホーム**というボックスが表示されることがあります。その場合は**新しいコンソールのホームに切り替える**というボタンを押してください。AWSのマネジメントコンソールは、ユーザーの要望を取り入れて日々進化しているため、このような表示が出ることがあります
    :::

1. マネジメントコンソールがブラウザ上に表示されます。AWSの世界へようこそ！
    > パスワードを保存するかを確認されることがありますが、どちらでも構いません。再ログインする可能性がある場合は、手間を省くために保存しても結構です
1. 画面右上に**東京**と表示されていることを確認してください。東京以外の表示になっている場合はその地名をクリックし、ドロップダウンボックスから**東京**を選択してください

## 2. DynamoDB テーブルの作成
- 楽曲データを格納するテーブルを作成します
1. 画面左上の虫眼鏡アイコンのボックスに**DynamoDB**と入力します（小文字でも可）。表示された一覧から**DyanmoDB**をクリックしてください
    > DynamoDBという文字をクリックしてください。他の箇所はクリックしても反応しません
1. DynamoDBのダッシュボードが表示されます。
1. 左側のメニューにて、**テーブル**をクリックしてください
1. 右上の [テーブルの作成] ボタンをクリックしてください

    ::: tip 
    一般的なRDBでは、データベースを作成したあとに必要なテーブルを作成しますが、DynamoDBではいきなりテーブルの作成から開始します。
    :::

1. 以下を設定します
    |項目|設定値
    |:--|:--
    |テーブル名|Music
    |パーティションキー|artist 
    |ソートキー|song 

    ::: tip 
    パーティションキーは、RDBでいうと主キーに相当します。
    それぞれのレコード（DynamoDBでは項目といいます）をユニークに識別するためのキーであると同時に、データを検索する際のキーになります。
    ソートキーは、オプションで追加できるキーです。
    パーティションキーだけではデータをユニークにできない場合にパ＝ティションキーと組み合わせて複合主キーとして利用できます。
    :::

1. その他の情報はそのままで、右下の [テーブルを作成] ボタンをクリックしてください
1. テーブルの一覧画面に戻ります。Musicテーブルの状態が**アクティブ**になるのを待って次の手順に移ってください

## 3. 新規データの作成
- 楽曲テーブルに実際にデータを作成します
1. 左側のメニューにて、**テーブル**の下の**項目を探索**をクリックしてください
1. テーブルの一覧から**Music**テーブルを探してクリックします

    ::: tip 
    DynamoDBのすべてのデータ操作は、APIによって実行されますが、マネジメントコンソールにもデータ管理用の画面が用意されています。
    ここでは、データの作成や更新、削除と行った操作はもとよりデータの検索を行うことができます。
    :::

1. [項目を作成]をクリックします
1. 以下を入力します
    |属性名|値
    |:--|:--
    |artist|Bob Dylan
    |song|Blowin' in the wind 
1. 右下の [項目を作成] ボタンをクリックしてください
1. 項目が1つ追加されていることを確認します
1. 右の [項目を作成] ボタンをクリックし、上記と同様の手順で以下の3件の項目を作成します。
    |属性名|値
    |:--|:--
    |artist|Bob Dylan
    |song|Like a Rolling Stone 

    |属性名|値|タイプ
    |:--|:--|--
    |artist|Michael Jackson
    |song|Billie Jean 

    |属性名|値|タイプ
    |:--|:--|--
    |artist|George Michael
    |song|Faith 

1. 正しく項目が作成されていると3件の項目が一覧に表示されています

## 4. データの検索
- 楽曲テーブルに登録されているデータを条件付きで検索します
1. 左側のメニューにて、**テーブル**の下の**項目を探索**をクリックしてください
1. テーブルの一覧から**Music**テーブルを探してクリックします
1. [項目のスキャンまたはクエリ]をクリックします
1. 項目を検索するための検索パネルが表示されます
1. **クエリ**を選択し、**artist (パーティションキー)**に`Bob Dylan`を入力します
1. ソートキーは入力せずに[実行する]をクリックします
1. 項目の一覧に2件、Bob Dylan の曲だけが表示されます

    ::: tip 
    検索結果の一覧では、項目がソートキーによってソートされています。
    このようにDynamoDBでは、パーティションキーを元にデータを検索し、ソートキーによってソートされたデータを取得できます。
    :::

1. **項目のスキャンまたはクエリ**にある、ソートキーに`Like a Rolling Stone`を入力して[実行する]をクリックします
1. パーティションキーとソートキーを両方指定したので特定hの1件だけが表示されています
1. **項目のスキャンまたはクエリ**にある、**スキャン**を選択します
1. フィルターを開き、以下を入力します
    |フィールド名|値
    |:--|:--
    |属性名|artist
    |条件|次を含む 
    |値|Michael 

1. [実行する]をクリックします
1. **artist** に **Michael**を含む2件の項目が表示されます

    ::: tip 
    DynamoDBは、主キーであるパーティションキーの完全一致による検索がメインですが、任意の属性にフィルターを実行することで特定の項目を検索することができます。
    :::

## 5. データの更新
- 項目に新しい属性を追加します
1. 左側のメニューにて、**テーブル**の下の**項目を探索**をクリックしてください
1. テーブルの一覧から**Music**テーブルを探してクリックします
1. 4件ある項目から**Michael Jackson**のリンクをクリックします
1. **新しい属性に追加**をクリックして**数値**を選択します
1. NewValue と入力されている**属性名**に`year`を入力し、**値**に`1982`と入力します
1. 右下の[変更を保存]をクリックします
1. 1件だけ**year**に値が表示されます
｀
    ::: tip 
    DynamoDBは、RDB ていうところのスキーマを主キー（パーティションキーとソートキー）以外は持っていないため、各項目ごとにどんな属性を持つかを変えられます。
    :::

## 6. （オプション課題）インデックスの作成
- year をソートキーにして年別の曲一覧を取得できるようにします
1. 上記データの更新の手順に従い残りのデータにも**year**を入力します

    |song|year
    |:--|:--
    |Faith|1987
    |Blowin' in the Wind|1963
    |Like a Rolling Stone|1965

1. 左側のメニューにて、**テーブル**の下の**設定の更新**をクリックしてください
1. テーブルの一覧から**Music**テーブルを探してクリックします
1. **インデックス**というタブをクリックします
1. 画面右の[インデックスの作成]をクリックします
1. 以下を入力します
    |フィールド名|値
    |:--|:--
    |パーティションキー|song
    |ソートキー - オプション|year 
    |ソートキー - オプションのデータタイプ|数値 
    |インデックス名|song-year-index 
1. 画面右下の[インデックスの作成]をクリックします
1. インデックスの一覧が表示されるので、**song-year-index**の状態が**アクティブ**になるまで待ちます
1. 左側のメニューにて、**テーブル**の下の**項目を探索**をクリックしてください
1. テーブルの一覧から**Music**テーブルを探してクリックします
1. **項目のスキャンまたはクエリ**にある、**スキャン**を選択します
1. **テーブルまたはインデックスを選択**から**song-year-index**を選択します
    > インデックスが表示されない場合は、画面をリロードしてください
1. フィルターは何も設定せずに[実行する]をクリックします
1. 項目の一覧で**song**が**year**ごとに並んでいることを確認します
    > 4件の項目が表示されない場合があります。これは、インデックスの更新状況によります

# おわりに
- お疲れ様でした！演習はいかがだったでしょうか？
- 同じようなデータベースをリレーショナルデータベースで作成する手順を考えると、DynamoDBは簡単に素早くデータベースを用意できたと感じられたと思います。
- また、リレーショナルデータベースと違い、SQLではないデータ操作や、スキーマが項目によって違う点が新鮮だった方もいらっしゃるかもしれません。
- もしよろしければ、Zoomチャットなどで演習の感想を聞かせてください！
